


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > WorldService</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.sparta.zmsb.weekfiveteamproject.service</a>
</div>

<h1>Coverage Summary for Class: WorldService (com.sparta.zmsb.weekfiveteamproject.service)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">WorldService</td>
<td class="coverageStat">
  <span class="percent">
    88.9%
  </span>
  <span class="absValue">
    (24/27)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    76.5%
  </span>
  <span class="absValue">
    (26/34)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    89.6%
  </span>
  <span class="absValue">
    (103/115)
  </span>
</td>
</tr>
  <tr>
    <td class="name">WorldService$$SpringCGLIB$$0</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    88.9%
  </span>
  <span class="absValue">
    (24/27)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    76.5%
  </span>
  <span class="absValue">
    (26/34)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    89.6%
  </span>
  <span class="absValue">
    (103/115)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.sparta.zmsb.weekfiveteamproject.service;
&nbsp;
&nbsp;import com.sparta.zmsb.weekfiveteamproject.entities.CityEntity;
&nbsp;import com.sparta.zmsb.weekfiveteamproject.entities.CountryEntity;
&nbsp;import com.sparta.zmsb.weekfiveteamproject.entities.CountrylanguageEntity;
&nbsp;import com.sparta.zmsb.weekfiveteamproject.entities.CountrylanguageEntityId;
&nbsp;import com.sparta.zmsb.weekfiveteamproject.repositories.CityRepository;
&nbsp;import com.sparta.zmsb.weekfiveteamproject.repositories.CountryLanguageRepository;
&nbsp;import com.sparta.zmsb.weekfiveteamproject.repositories.CountryRepository;
&nbsp;import jakarta.transaction.Transactional;
&nbsp;import org.springframework.beans.factory.annotation.Autowired;
&nbsp;import org.springframework.data.jpa.repository.Modifying;
&nbsp;import org.springframework.stereotype.Service;
&nbsp;
&nbsp;
&nbsp;import java.util.*;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;@Service
&nbsp;public class WorldService {
&nbsp;
&nbsp;
&nbsp;
&nbsp;    private final CityRepository cityRepository;
&nbsp;    private final CountryRepository countryRepository;
&nbsp;    private final CountryLanguageRepository countryLanguageRepository;
&nbsp;
&nbsp;    @Autowired
&nbsp;    public WorldService(CityRepository cityRepository, CountryRepository countryRepository,
<b class="fc">&nbsp;                        CountryLanguageRepository countryLanguageRepository) {</b>
&nbsp;
<b class="fc">&nbsp;        this.cityRepository = cityRepository;</b>
<b class="fc">&nbsp;        this.countryRepository = countryRepository;</b>
<b class="fc">&nbsp;        this.countryLanguageRepository = countryLanguageRepository;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Transactional
&nbsp;    public void deleteCity(Integer id) {
<b class="fc">&nbsp;        Optional&lt;CityEntity&gt; cityOptional = cityRepository.findById(id);</b>
&nbsp;
<b class="fc">&nbsp;        if (cityOptional.isPresent()) {</b>
<b class="fc">&nbsp;            cityRepository.delete(cityOptional.get());</b>
&nbsp;        } else {
<b class="fc">&nbsp;            throw new RuntimeException(&quot;City with id &quot; + id + &quot; not found&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public List&lt;CountryEntity&gt; countriesWithNoHeadOfState() {
<b class="fc">&nbsp;        return countryRepository.findAll().stream()</b>
<b class="fc">&nbsp;                .filter(country -&gt; country.getHeadOfState() == null || country.getHeadOfState().isBlank())</b>
<b class="fc">&nbsp;                .collect(Collectors.toList());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Transactional
&nbsp;    public String whichCountryHasMostCities() {
&nbsp;
<b class="fc">&nbsp;        List&lt;CityEntity&gt; cities = allCities();</b>
<b class="fc">&nbsp;        Map&lt;String, Long&gt; mostCitiesCount = cities.stream()</b>
<b class="fc">&nbsp;                .collect(Collectors.groupingBy(</b>
<b class="fc">&nbsp;                        c -&gt; c.getCountryCode().getName()</b>
<b class="fc">&nbsp;                        , Collectors.counting()));</b>
&nbsp;
<b class="fc">&nbsp;        return mostCitiesCount.entrySet().stream()</b>
<b class="fc">&nbsp;                .max(Map.Entry.comparingByValue())</b>
<b class="fc">&nbsp;                .map(Map.Entry::getKey).orElse(&quot;&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Transactional
&nbsp;    public double percentageOfGivenCountriesPopulationThatLivesInTheLargestCity(String countryName) {
&nbsp;
<b class="fc">&nbsp;        List&lt;CityEntity&gt; cities = allCities();</b>
<b class="fc">&nbsp;        List&lt;CountryEntity&gt; countries = allCountries();</b>
&nbsp;
<b class="fc">&nbsp;        String countryCode = getCountryCode(countryName, countries);</b>
<b class="fc">&nbsp;        int countryTotalPopulation = getCountryTotalPopulation(countries, countryCode);</b>
<b class="fc">&nbsp;        int biggestCityPopulation = getBiggestCityPopulation(cities, countryCode);</b>
<b class="fc">&nbsp;        return (double) biggestCityPopulation / countryTotalPopulation * 100;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getCountryCode(String countryName, List&lt;CountryEntity&gt; countries) {
<b class="fc">&nbsp;        return countries.stream()</b>
<b class="fc">&nbsp;                .filter(cE -&gt; cE.getName().equals(countryName))</b>
<b class="fc">&nbsp;                .map(CountryEntity::getCode)</b>
<b class="fc">&nbsp;                .findFirst().orElse(&quot;&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getBiggestCityPopulation(List&lt;CityEntity&gt; cities, String countryCode) {
&nbsp;
<b class="fc">&nbsp;        if (!doesCityExist(cities, countryCode)) {</b>
<b class="fc">&nbsp;            return cities.stream()</b>
<b class="fc">&nbsp;                    .filter(ciEn -&gt; ciEn.getCountryCode().getCode().equals(countryCode))</b>
<b class="fc">&nbsp;                    .max(Comparator.comparingInt(CityEntity::getPopulation))</b>
<b class="fc">&nbsp;                    .get().getPopulation();</b>
<b class="fc">&nbsp;        } else return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getCountryTotalPopulation(List&lt;CountryEntity&gt; countries, String countryCode) {
<b class="fc">&nbsp;        return countries.stream()</b>
<b class="fc">&nbsp;                .filter(ce -&gt; ce.getCode().equals(countryCode))</b>
<b class="fc">&nbsp;                .map(CountryEntity::getPopulation)</b>
<b class="fc">&nbsp;                .findFirst().orElse(1);</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean doesCityExist(List&lt;CityEntity&gt; cities, String countryCode) {
<b class="fc">&nbsp;        return cities.stream()</b>
<b class="fc">&nbsp;                .filter(ciEn -&gt; ciEn.getCountryCode().getCode().equals(countryCode))</b>
<b class="fc">&nbsp;                .max(Comparator.comparingInt(CityEntity::getPopulation))</b>
<b class="fc">&nbsp;                .isEmpty();</b>
&nbsp;    }
&nbsp;
&nbsp;    public int amountOfPeopleSpeakingOfficialLanguage(String countryName) {
<b class="fc">&nbsp;        List&lt;CountryEntity&gt; countries = allCountries();</b>
&nbsp;
<b class="fc">&nbsp;        String countryCode = countries.stream()</b>
<b class="fc">&nbsp;                .filter(cE -&gt; cE.getName().equals(countryName))</b>
<b class="fc">&nbsp;                .map(CountryEntity::getCode)</b>
<b class="fc">&nbsp;                .findFirst()</b>
<b class="fc">&nbsp;                .orElse(&quot;Name not found&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        if (&quot;Name not found&quot;.equals(countryCode)) {</b>
<b class="fc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        int population = countries.stream()</b>
<b class="fc">&nbsp;                .filter(cE -&gt; cE.getCode().equals(countryCode))</b>
<b class="fc">&nbsp;                .findFirst()</b>
<b class="fc">&nbsp;                .map(CountryEntity::getPopulation)</b>
<b class="fc">&nbsp;                .orElse(0);</b>
&nbsp;
<b class="fc">&nbsp;        List&lt;CountrylanguageEntity&gt; officialLanguages = officialLanguagesOfCountry(countryCode);</b>
<b class="fc">&nbsp;        Optional&lt;CountrylanguageEntity&gt; mostSpoken = mostSpokenLanguageInCountry(officialLanguages);</b>
&nbsp;
<b class="pc">&nbsp;        if (mostSpoken.isPresent()) {</b>
<b class="fc">&nbsp;            return (int) (population * mostSpoken.get().getPercentage().doubleValue() / 100);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private List&lt;CountrylanguageEntity&gt; officialLanguagesOfCountry(String countryCode) {
<b class="fc">&nbsp;        List&lt;CountrylanguageEntity&gt; languages = countryLanguageRepository.findAll();</b>
<b class="fc">&nbsp;        List&lt;CountrylanguageEntity&gt; officialLanguages = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        for (CountrylanguageEntity language : languages) {</b>
<b class="fc">&nbsp;            if (language.getId().getCountryCode().equals(countryCode) &amp;&amp; language.getIsOfficial().equals(&quot;T&quot;)) {</b>
<b class="fc">&nbsp;                officialLanguages.add(language);</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return officialLanguages;</b>
&nbsp;    }
&nbsp;
&nbsp;    private Optional&lt;CountrylanguageEntity&gt; mostSpokenLanguageInCountry(List&lt;CountrylanguageEntity&gt; languages) {
<b class="pc">&nbsp;        if (languages.isEmpty()) {</b>
<b class="nc">&nbsp;            return Optional.empty();</b>
&nbsp;        }
<b class="fc">&nbsp;        CountrylanguageEntity mostSpokenLanguage = languages.get(0);</b>
<b class="fc">&nbsp;        for (CountrylanguageEntity language : languages) {</b>
<b class="pc">&nbsp;            if (language.getPercentage().compareTo(mostSpokenLanguage.getPercentage()) &gt; 0) {</b>
<b class="nc">&nbsp;                mostSpokenLanguage = language;</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return Optional.of(mostSpokenLanguage);</b>
&nbsp;    }
&nbsp;
&nbsp;    public List&lt;CountryEntity&gt; allCountries() {
<b class="fc">&nbsp;        return countryRepository.findAll();</b>
&nbsp;    }
&nbsp;
&nbsp;    public List&lt;CityEntity&gt; allCities() {
<b class="fc">&nbsp;        return cityRepository.findAll();</b>
&nbsp;    }
&nbsp;
&nbsp;    public List&lt;CountrylanguageEntity&gt; allLanguages() {
<b class="fc">&nbsp;        return countryLanguageRepository.findAll();</b>
&nbsp;    }
&nbsp;    
&nbsp;    public String getSmallestDistrictsByPopulation() {
<b class="fc">&nbsp;        List&lt;CityEntity&gt; cities = allCities();</b>
<b class="fc">&nbsp;        LinkedHashMap&lt;String, Integer&gt; districtPopulations = new LinkedHashMap&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;        for (CityEntity city : cities) {</b>
<b class="fc">&nbsp;            if (districtPopulations.containsKey(city.getDistrict())) {</b>
<b class="fc">&nbsp;                districtPopulations.put(city.getDistrict(), districtPopulations.get(city.getDistrict()) + city.getPopulation());</b>
&nbsp;            } else {
<b class="fc">&nbsp;                districtPopulations.put(city.getDistrict(), city.getPopulation());</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        ArrayList&lt;Map.Entry&lt;String, Integer&gt;&gt; sortedDistricts = new ArrayList&lt;&gt;(districtPopulations.entrySet());</b>
<b class="fc">&nbsp;        sortedDistricts.sort(Map.Entry.comparingByValue());</b>
&nbsp;
<b class="fc">&nbsp;        StringBuilder smallestDistricts = new StringBuilder();</b>
&nbsp;
<b class="fc">&nbsp;        for (int i = 0; i &lt; 5; i++) {</b>
<b class="fc">&nbsp;            smallestDistricts.append(sortedDistricts.get(i).getKey()).append(&quot;, &quot;);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        smallestDistricts.delete(smallestDistricts.length() - 2, smallestDistricts.length());</b>
&nbsp;
<b class="fc">&nbsp;        return String.valueOf(smallestDistricts);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Transactional
&nbsp;    public long getNumberOfCitiesThatCountryWithHighestNumberOfCitiesHas() {
<b class="fc">&nbsp;        List&lt;CityEntity&gt; cities = allCities();</b>
<b class="fc">&nbsp;        Map&lt;String, Long&gt; mostCitiesCount = cities.stream()</b>
<b class="fc">&nbsp;                .collect(Collectors.groupingBy(</b>
<b class="fc">&nbsp;                        c -&gt; c.getCountryCode().getName()</b>
<b class="fc">&nbsp;                        , Collectors.counting()));</b>
&nbsp;
<b class="fc">&nbsp;        Optional&lt;Long&gt; cityCount = mostCitiesCount.entrySet().stream()</b>
<b class="fc">&nbsp;                .max(Map.Entry.comparingByValue())</b>
<b class="fc">&nbsp;                .map(Map.Entry::getValue);</b>
&nbsp;
<b class="pc">&nbsp;        if (cityCount.isPresent()) {</b>
<b class="fc">&nbsp;            return cityCount.get();</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0;</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    // CRUD for CountryLanguageEntity
&nbsp;    // Create
&nbsp;    @Transactional
&nbsp;    public void createCountryLanguageEntityEntry(CountrylanguageEntity countrylanguageEntity) {
<b class="nc">&nbsp;        countryLanguageRepository.saveAndFlush(countrylanguageEntity);</b>
&nbsp;    }
&nbsp;    // Read
&nbsp;    @Transactional
&nbsp;    public ArrayList&lt;CountrylanguageEntity&gt; getCountryLanguagesByCountryCode(CountrylanguageEntityId countrylanguageEntityId) {
<b class="nc">&nbsp;        ArrayList&lt;CountrylanguageEntity&gt; countryLanguageEntities = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        List&lt;CountrylanguageEntity&gt; allLanguages = countryLanguageRepository.findAll();</b>
<b class="nc">&nbsp;        for (CountrylanguageEntity countrylanguageEntity : allLanguages) {</b>
<b class="nc">&nbsp;            if (countrylanguageEntityId.getCountryCode().equals(countrylanguageEntity.getCountryCode())) {</b>
<b class="nc">&nbsp;                countryLanguageEntities.add(countrylanguageEntity);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return countryLanguageEntities;</b>
&nbsp;    }
&nbsp;    // Update
&nbsp;    @Modifying
&nbsp;    @Transactional
&nbsp;    public void updateCountryLanguageEntity(CountrylanguageEntity countrylanguageEntity) {
<b class="fc">&nbsp;        countryLanguageRepository.saveAndFlush(countrylanguageEntity);</b>
&nbsp;    }
&nbsp;    // Delete
&nbsp;    @Transactional
&nbsp;    public void deleteCountryLanguageEntity(CountrylanguageEntity countrylanguageEntity) {
<b class="nc">&nbsp;        countryLanguageRepository.delete(countrylanguageEntity);</b>
&nbsp;    }
&nbsp;    @Transactional
&nbsp;    public void createNewCountry(CountryEntity country) {
<b class="fc">&nbsp;        countryRepository.saveAndFlush(country);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Transactional
&nbsp;    public void deleteCountry(CountryEntity country) {
<b class="fc">&nbsp;        countryRepository.delete(country);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Transactional
&nbsp;    public CountryEntity getCountry(String countryCode) {
<b class="fc">&nbsp;        List&lt;CountryEntity&gt; allCountries = countryRepository.findAll();</b>
<b class="fc">&nbsp;        return allCountries.stream().filter(ce-&gt;ce.getCode().equals(countryCode)).findFirst().orElse(null);</b>
&nbsp;    }
&nbsp;    @Transactional
&nbsp;    public void updateCountry(CountryEntity country){
<b class="fc">&nbsp;        countryRepository.saveAndFlush(country);</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-07-12 09:08</div>
</div>
</body>
</html>
